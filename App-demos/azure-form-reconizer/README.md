
# Copilot & Azure Form Recognizer Service

Video of the demo available on Rewatch : [Using Copilot and Azure Form Recognizer](https://github.rewatch.com/video/u3ztcaaw9bzpbao6-using-copilot-and-azure-form-recognizer)


## Content

- `./solutions/` contains the solutions and the result HTML file
- `./population.png` is the image used for the demo
- `./read_tablefrom_image.py` is the Python script used for the demo


## Run the application


If you want to run the demonstration, and not only show the Copilot suggestions, you will need to follow the instructions below.



- Get a Form Recognizer API key and endpoint following the doc: [Quickstart: Create a Cognitive Services resource using the Azure portal](https://learn.microsoft.com/en-gb/azure/cognitive-services/cognitive-services-apis-create-account).

- Python 3.10 & Pip

- Import packages
   ```
   pip install azure-ai-formrecognizer
   ```
- Set environment variables
    ```
    export AZURE_FORM_RECOGNIZER_ENDPOINT=<your-form-recognizer-endpoint>
    export AZURE_FORM_RECOGNIZER_KEY=<your-form-recognizer-key>
    ```

- Run the script
    ```
    python read_tablefrom_image.py
    ```



## Demo Script

- Open the file `read_tablefrom_image.py` in VS Code
- Explain that you have the skeleton of a Python script that will use the Azure Form Recognizer service 
- Add the comment to use the DocumentAnalysisClient 
- Explain that the DocumentAnalysisClient is a client that will help us to analyze documents
    ```python
    # create a DocumentAnalysisClient
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
        document_analysis_client = DocumentAnalysisClient(endpoint, AzureKeyCredential(key))
    ```
    </details>

- Point to the image and tell Copilot to call the analyze with prebuild-layout model
   ``` python
    # open the image "./population.png" and analyze it with prebuilt-layout
   ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
    with open("./population.png", "rb") as f:
        poller = document_analysis_client.begin_analyze_document("prebuilt-layout", document=f)
    result = poller.result()
    ```
    _Note: remove one indentation for the result_
    </details>


- Ask Copilot to use find a way to get the table informations from the result
    ```python
        # get the table informaton from the result and print the number of lines and columns
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
    tables = result.tables
    for idx, table in enumerate(tables):
        print("Table {} has {} rows and {} columns".format(idx, table.row_count, table.column_count))
    ```    
    </details>

- Ask Copilot to print the content of the table
    ```python
        # print the table data
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
        for cell in table.cells:
            print("...Cell[{}][{}] has text '{}' ".format(
                cell.row_index,
                cell.column_index,
                cell.content
            ))
    ```    
    _Note: Copilot will probably also add `cell.confidence` that does not exist in the cell object. You can either remove it directly, and run/test/retry explaining that you are learning with Copilot_

    </details>   

- Run the application and show the result
    ```
    python read_tablefrom_image.py
    ```

- Let's now put the data in an Array (could be a Dictionary),  
    ```python
        rows = []; # to store the rows

        # iterate of the rows using the row_index
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
        for row_index in range(table.row_count):
            row = [];

            # iterate over the celles and append the content to the row if the row_index matches
            for cell in table.cells:
                if cell.row_index == row_index:
                    row.append(cell.content)


            # apend the row to rows
            rows.append(row)
    ```    
    _Note: Here you may have to "tweak" adapt to get the proper structure, and it is NOT optimized as we read the cells many times_
    </details>

- Print the rows
    ```python
        # print the rows in a loop
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
        for row in rows:
            print(row)
    ```
    </details>

- Run the application and show the result
    ```
    python read_tablefrom_image.py
    ```
- Explain that we can now use the data to do something else, like for example, create an HTML file (could be CSV, JSON, Excel, etc.)
    ```python
       # print the rows into a HTML table and save it to a file
    ```
    <details>
    <summary>Code generated by Copilot</summary>

    ```python
        html = "<table>"
        for row in rows:
            html += "<tr>"
            for cell in row:
                html += "<td>{}</td>".format(cell)
            html += "</tr>"
        html += "</table>"
        with open("table.html", "w") as f:
            f.write(html)
    ```
    </details>


- Run the application and show the result
    ```
    > python read_tablefrom_image.py
    > open table.html
    ```

